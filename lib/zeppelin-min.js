!function(t,i){"use strict";var e,s;return"undefined"!=typeof exports?e=exports:t.Zeppelin=t.Z=e=s={},e.$=i.$,e.extend=i.View.extend,e.VERSION="0.0.1-alpha",e.Util={Error:function(t){throw new Error(t)},isView:function(t){var i;return t?(i=_.isFunction(t)?t.prototype.toString():t.toString(),"[object View]"===i):!1},isModel:function(t){var i;return t?(i=_.isFunction(t)?t.prototype.toString():t.toString(),"[object Model]"===i):!1},isCollection:function(t){var i;return t?(i=_.isFunction(t)?t.prototype.toString():t.toString(),"[object Collection]"===i):!1},isRegion:function(t){var i;return t?(i=_.isFunction(t)?t.prototype.toString():t.toString(),"[object Region]"===i):!1},isLayout:function(t){var i;return t?(i=_.isFunction(t)?t.prototype.toString():t.toString(),"[object Layout]"===i):!1},isController:function(t){var i;return t?(i=_.isFunction(t)?t.prototype.toString():t.toString(),"[object Controller]"===i):!1},isRouter:function(t){var i;return t?(i=_.isFunction(t)?t.prototype.toString():t.toString(),"[object Router]"===i):!1},isApplication:function(t){var i;return t?(i=_.isFunction(t)?t.prototype.toString():t.toString(),"[object Application]"===i):!1},isStorage:function(t){var i;return t?(i=_.isFunction(t)?t.prototype.toString():t.toString(),"[object Storage]"===i):!1},isJqueryObject:function(t){return t instanceof jQuery},isInDOM:function(t){return _.isElement(t)||(t=s.Util.isJqueryObject(t)?t[0]:s.$(t)[0]),s.$.contains(document,t)},getElementEvents:function(t){return _.isElement(t)||(t=s.Util.isJqueryObject(t)?t[0]:s.$(t)[0]),s.$._data(t,"events")},getInstance:function(t,i){return _.isFunction(t)?new t(i):t}},e.Subscriptions=_.extend({subscriptions:{},hasSubscriptions:function(){return _.size(this._subscriptions)>0},hasSubscription:function(t){return void 0!==this._subscriptions[t]},subscribe:function(t,e){return _.isFunction(e)||(e=this[e]),this.listenTo(i.Events,t,e),this._subscriptions[t]=e,this},subscribeToOnce:function(t,e){return _.isFunction(e)||(e=this[e]),this.listenToOnce(i.Events,t,e),this._subscriptions[t]=e,this},addSubscriptions:function(t){return t=t||_.result(this,"subscriptions"),_.forOwn(t,function(t,i){this.subscribe(i,t)},this),this},broadcast:function(){return i.Events.trigger.apply(this,arguments),i.Events.trigger.apply(i.Events,arguments),this},unsubscribe:function(t){return t?(this.stopListening(i.Events,t),delete this._subscriptions[t]):t||(this.stopListening(i.Events),this._subscriptions={}),this},request:function(t,i,e){var s=_.uniqueId("resp:"+t);return 2===arguments.length&&(e=i),_.isFunction(e)||(e=this[e]),e?(this.subscribeToOnce(s,e),3===arguments.length&&void 0!==i?this.broadcast(t,s,i):this.broadcast(t,s),this):this}},i.Events),e.Storage=function(t){t=t||{},_.merge(this,t),this.cid=_.uniqueId("storage"),this.type="localStorage",this.store=localStorage,t.type&&("localStorage"===t.type?(this.type="localStorage",this.store=localStorage):"sessionStorage"===t.type&&(this.type="sessionStorage",this.store=sessionStorage)),this.namespace=t.namespace||this.cid,this._subscriptions={},this.addSubscriptions()},_.extend(e.Storage.prototype,{toString:function(){return"[object Storage]"},has:function(t){return this.get(t)?!0:!1},length:function(){return _.size(this.getAll())},isEmpty:function(){return 0===this.length()},set:function(t,i){var e=this.getAll();return _.isPlainObject(t)?this.setAll(_.extend(e,t)):_.isString(t)&&(e[t]=i,this.setAll(e)),this},setAll:function(t){return this.store.setItem(this.namespace,JSON.stringify(t)),this},get:function(t){return this.getAll()[t]},getAll:function(){return JSON.parse(this.store.getItem(this.namespace))||{}},clear:function(t){var i=this.getAll();return _.isString(t)&&(delete i[t],this.setAll(i)),this},clearAll:function(){return this.store.removeItem(this.namespace),this},unplug:function(){return this.trigger("before:unplug",this),this.off(),this.stopListening(),this._isUnplugged=!0,this.trigger("after:unplug",this),this.onUnplug(this),this},onUnplug:function(){return this},isUnplugged:function(){return this._isUnplugged}}),_.extend(e.Storage.prototype,e.Subscriptions),e.Storage.extend=e.extend,e.Validations={exists:function(t){return void 0===t?!1:null===t?!1:_.isNaN(t)?!1:1/0===t?!1:!0},matchesRegExp:function(t,i){return this.isString(t)&&this.isRegExp(i)?i.test(t):!1},isEmpty:function(t){return this.exists(t)?_.isEmpty(t):!0},isEqual:function(t,i){return this.exists(t)?_.isEqual(t,i):!1},isRegExp:function(t){return this.exists(t)?_.isRegExp(t):!1},isBoolean:function(t){return this.exists(t)?_.isBoolean(t):!1},isObject:function(t){return this.exists(t)?_.isObject(t):!1},isPlainObject:function(t){return this.exists(t)?_.isPlainObject(t):!1},isArray:function(t){return this.exists(t)?_.isArray(t):!1},isString:function(t){return this.exists(t)?_.isString(t):!1},isNumber:function(t){return this.exists(t)?_.isNumber(t):!1},isOneOf:function(t,i){return this.exists(t)&&this.isArray(i)?-1!==_.indexOf(i,t):!1},isDate:function(t){var i;return this.exists(t)?(i=new Date(t),"Invalid Date"!==i.toString()&&_.isDate(i)):!1},isDateISO:function(t){return this.isString(t)?/^(\d{4})\D?(0[1-9]|1[0-2])\D?([12]\d|0[1-9]|3[01])$/.test(t):!1},isDigit:function(t){return this.isString(t)?/^-?\d+\.?\d*$/.test(t):!1},isEmail:function(t){return this.isString(t)?/^[\+a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/.test(t):!1},isUrl:function(t){return this.isString(t)?/^(ftp|http|https):\/\/[^ "]+$/.test(t):!1},isDomainName:function(t){return this.isString(t)?/^(?!:\/\/)([a-zA-Z0-9]+\.)?[a-zA-Z0-9][a-zA-Z0-9-]+\.[a-zA-Z]{2,6}?$/.test(t):!1},isAlphanumeric:function(t){return this.isString(t)?/^\w+$/.test(t):!1},isPhone:function(t){return this.isString(t)?/^(?:\+?1[-. ]?)?\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/.test(t):!1},isMinimum:function(t,i){return this.isNumber(t)&&this.isNumber(i)?t>=i:!1},isMaximum:function(t,i){return this.isNumber(t)&&this.isNumber(i)?i>=t:!1},isInRange:function(t,i){var e,s;return this.isNumber(t)&&this.isArray(i)?(e=i[0],s=_.last(i),this.isNumber(e)&&this.isNumber(s)?t>=e&&s>=t:!1):!1},isOfLength:function(t,i){return this.exists(t)&&void 0!==t.length&&this.isNumber(i)?t.length===i:!1},isOfMinimumLength:function(t,i){return this.exists(t)&&void 0!==t.length&&this.isNumber(i)?t.length>=i:!1},isOfMaximumLength:function(t,i){return this.exists(t)&&void 0!==t.length&&this.isNumber(i)?t.length<=i:!1},isLengthInRange:function(t,i){var e,s;return this.exists(t)&&void 0!==t.length&&this.isArray(i)?(e=i[0],s=_.last(i),this.isNumber(e)&&this.isNumber(s)?t.length>=e&&t.length<=s:!1):!1}},e.Bindings={bindings:{},addBinding:function(t,i){return _.isPlainObject(i)?("self"===t?this.addSelfBinding(i):"model"===t?this.addModelBinding(i):"collection"===t?this.addCollectionBinding(i):"views"===t?_.forOwn(i,function(t,i){this.addViewBinding(i,t)},this):"regions"===t&&_.forOwn(i,function(t,i){this.addRegionBinding(i,t)},this),this):this},addSelfBinding:function(t){return _.forOwn(t,function(t,i){var e=!1;_.isPlainObject(t)&&(e=t.once||!1,t=t.callback),_.isFunction(t)||(t=this[t]),i&&t&&(e?this.once(i,t):this.on(i,t))},this),this},addModelBinding:function(t){return _.forOwn(t,function(t,i){var e=!1;_.isPlainObject(t)&&(e=t.once||!1,t=t.callback),_.isFunction(t)||(t=this[t]),i&&t&&_.result(this,"hasModel")&&(e?this.listenToOnce(this.model,i,t):this.listenTo(this.model,i,t))},this),this},addCollectionBinding:function(t){return _.forOwn(t,function(t,i){var e=!1;_.isPlainObject(t)&&(e=t.once||!1,t=t.callback),_.isFunction(t)||(t=this[t]),i&&t&&_.result(this,"hasCollection")&&(e?this.listenToOnce(this.collection,i,t):this.listenTo(this.collection,i,t))},this),this},addViewBinding:function(t,i){var e=this.getView?this.getView(t):void 0;return s.Util.isView(e)?(_.forOwn(i,function(t,i){var s=!1;_.isPlainObject(t)&&(s=t.once||!1,t=t.callback),_.isFunction(t)||(t=this[t]),i&&t&&(s?this.listenToOnce(e,i,t):this.listenTo(e,i,t))},this),this):this},addRegionBinding:function(t,i){var e=this.getRegion?this.getRegion(t):void 0;return s.Util.isRegion(e)?(_.forOwn(i,function(t,i){var s=!1;_.isPlainObject(t)&&(s=t.once||!1,t=t.callback),_.isFunction(t)||(t=this[t]),i&&t&&(s?this.listenToOnce(e,i,t):this.listenTo(e,i,t))},this),this):this},addBindings:function(t){return t=t||_.result(this,"bindings"),_.forOwn(t,function(t,i){this.addBinding(i,t)},this),this}},e.Mixin={},e.Mixin.hasLayouts={layouts:{},hasLayouts:function(){return _.size(this._layouts)>0},hasLayout:function(t){return void 0!==this._layouts[t]},getLayout:function(t){return this._layouts[t]},getLayoutName:function(t){var i;return s.Util.isLayout(t)?(_.forOwn(this._layouts,function(i,e){return _layout.cid===t.cid?(e=e,!1):void 0}),i):void 0},addLayout:function(t,i,e){return s.Util.isLayout(i)?(this.hasLayout(t)&&this.unplugLayout(t,!0),this._layouts[t]=s.Util.getInstance(i,e),this._layouts[t].on("after:remove",this._onViewRemoved,this),this):this},addLayouts:function(t){return t=t||_.result(this,"layouts"),_.forOwn(t,function(t,i){this.addLayout(i,t)},this),this},showLayout:function(t){return this.hasLayout(t)&&this.getLayout(t).show(),this},showLayouts:function(t){return t=t||_.keys(this._layouts),_.forEach(t,this.showLayout,this),this},closeLayout:function(t){return this.hasLayout(t)&&this.getLayout(t).close(),this},closeLayouts:function(t){return t=t||_.keys(this._layouts),_.forEach(t,this.closeLayout,this),this},unplugLayout:function(t,i){return i=i||!1,this.hasLayout(t)&&this.getLayout(t).unplug(i),this},unplugLayouts:function(t,i){return i=i||!1,t=t||_.keys(this._layouts),_.forEach(t,function(t){this.unplugLayout(t,i)},this),this},removeLayout:function(t){return this.hasLayout(t)&&(this.getLayout(t).off("after:remove",this._onLayoutRemoved,this).remove(),delete this._layouts[t]),this},removeLayouts:function(t){return t=t||_.keys(this._layouts),_.forEach(t,this.removeLayout,this),this},forEachLayout:function(t){return _.isFunction(t)||(t=this[t]),t&&_.forOwn(this._layouts,t,this),this},_onLayoutRemoved:function(t){var i=this.getLayoutName(t);return i&&this.removeLayout(i),this}},e.Mixin.hasRegions={regions:{},hasRegions:function(){return _.size(this._regions)>0},hasRegion:function(t){return void 0!==this._regions[t]},getRegion:function(t){return this._regions[t]},getRegionName:function(t){var i;return s.Util.isRegion(t)?(_.forOwn(this._regions,function(i,e){return _region.cid===t.cid?(e=e,!1):void 0}),i):void 0},addRegion:function(t,i,e){return s.Util.isRegion(i)?(this.hasRegion(t)&&this.unplugRegion(t,!0),this._regions[t]=s.Util.getInstance(i,e),this._regions[t].on("after:remove",this._onRegionRemoved,this),this):this},addRegions:function(t){return t=t||_.result(this,"regions"),_.forOwn(t,function(t,i){this.addRegion(i,t)},this),this},showRegion:function(t){return this.hasRegion(t)&&this.getRegion(t).show(),this},showRegions:function(t){return t=t||_.keys(this._regions),_.forEach(t,this.showRegion,this),this},closeRegion:function(t){return this.hasRegion(t)&&this.getRegion(t).close(),this},closeRegions:function(t){return t=t||_.keys(this._regions),_.forEach(t,this.closeRegion,this),this},unplugRegion:function(t,i){return i=i||!1,this.hasRegion(t)&&this.getRegion(t).unplug(i),this},unplugRegions:function(t,i){return i=i||!1,t=t||_.keys(this._regions),_.forEach(t,function(t){this.unplugRegion(t,i)},this),this},removeRegion:function(t){return this.hasRegion(t)&&(this.getRegion(t).off("after:remove",this._onRegionRemoved,this).remove(),delete this._regions[t]),this},removeRegions:function(t){return t=t||_.keys(this._regions),_.forEach(t,this.removeRegion,this),this},forEachRegion:function(t){return _.isFunction(t)||(t=this[t]),t&&_.forOwn(this._regions,t,this),this},_onRegionRemoved:function(t){var i=this.getRegionName(t);return i&&this.removeRegion(i),this}},e.Mixin.hasViews={views:{},hasViews:function(){return _.size(this._views)>0},hasView:function(t){return void 0!==this._views[t]},getView:function(t){return this._views[t]},getViewByCid:function(t){return _.find(this._views,function(i){return i.cid===t})},getViews:function(t){return _.isFunction(t)||(t=function(){return!0}),_.filter(this._views,function(i){return t(i)===!0})},getViewName:function(t){var i;return s.Util.isView(t)?(_.forOwn(this._views,function(i,e){return i.cid===t.cid?(e=e,!1):void 0}),i):void 0},addView:function(t,i){var e=s.Util.getInstance(i);return!s.Util.isView(i)&&_.isPlainObject(i)&&(e=s.Util.getInstance(i.view,i.options)),s.Util.isView(e)?(this._views[t]=e,e.on("after:remove",this._onViewRemoved,this),this):this},addViews:function(t){return t=t||_.result(this,"views"),_.forOwn(t,function(t,i){this.addView(i,t)},this),this},unplugView:function(t,i){return i=i||!1,this.hasView(t)&&this.getView(t).unplug(i),this},unplugViews:function(t,i){return i=i||!1,t=t||_.keys(this._views),_.forEach(t,function(t){this.unplugView(t,i)},this),this},removeView:function(t){return this.hasView(t)&&(this.getView(t).off("after:remove",this._onViewRemoved,this).remove(),delete this._views[t]),this},removeViews:function(t){return t=t||_.keys(this._views),_.forEach(t,this.removeView,this),this},forEachView:function(t){return _.isFunction(t)||(t=this[t]),t&&_.forOwn(this._views,t,this),this},_onViewRemoved:function(t){var i=this.getViewName(t);return i&&this.removeView(i),this}},e.Mixin.hasElements={elements:{},delegateEvent:function(t,i,e){return 2===arguments.length&&(e=i,i=t,t=void 0),i&&e?(i+=".delegateEvents"+this.cid,e=_.isFunction(e)?e:this[e],t?this.$el.on(i,t,_.bind(e,this)):this.$el.on(i,_.bind(e,this)),this):this},delegateEvents:function(){return i.View.prototype.delegateEvents.apply(this,arguments)},undelegateEvent:function(t,i){return 2===arguments.length?this.$el.off(i+".delegateEvents"+this.cid,t):(i=t,this.$el.off(i+".delegateEvents"+this.cid)),this},undelegateEvents:function(){return i.View.prototype.undelegateEvents.apply(this,arguments)},hasElements:function(){return _.size(this._elements)>0},hasElement:function(t){return void 0!==this._elements[t]},getElement:function(t){return this._elements[t]},getSelector:function(t){return this.elements[t]},addElement:function(t,i){return this._elements[t]=this.$(i),this},addElements:function(t){return t=t||_.result(this,"elements"),_.forOwn(t,function(t,i){this.addElement(i,t)},this),this},removeElement:function(t){var i=this.getElement(t);return i?(i.off(),delete this._elements[t],this):this},removeElements:function(t){return t=t||_.keys(this._elements),_.forEach(t,this.removeElement,this),this}},e.Mixin.hasPartials={partials:{},hasPartials:function(){return _.size(this.partials)>0},hasPartial:function(t){return void 0!==this.partials[t]},getPartial:function(t){return this.partials[t]},addPartial:function(t,i){return this.partials[t]=i,this},addPartials:function(t){return t=t||{},_.forOwn(t,function(t,i){this.addPartial(i,t)},this),this},renderPartial:function(t,i){return this.hasPartial(t)&&(i=_.isPlainObject(i)?i:_.result(this,"context"),this.$(t).html(this.getPartial(t)(i))),this}},e.Model=i.Model.extend({constructor:function(t,e){e=e||{},this.cacheId=e.cacheId||this.cacheId,this.cacheType=e.cacheType||this.cacheType,this._views=[],this._subscriptions={},this.createCache(),i.Model.prototype.constructor.apply(this,arguments),this.addSubscriptions()},cacheId:null,cacheType:"localStorage",toString:function(){return"[object Model]"},isPopulated:function(){return _.size(this.attributes)>0},localAttributes:[],getLocalAttributes:function(){return this.pick(_.result(this,"localAttributes"))},toJSON:function(){return this.omit(_.result(this,"localAttributes"))},validations:{},hasValidations:function(){return _.size(this.validations)>0},hasValidation:function(t){return void 0!==this.validations[t]},addValidation:function(t,i){return t&&i&&(_.isArray(i)||_.isPlainObject(i)||_.isFunction(i))&&(this.validations[t]=_.isArray(i)?i:[i]),this},validate:function(t){var i={},n={};return t=t||this.attributes,_.size(t)&&_.size(this.validations)&&(_.forOwn(this.validations,function(r,o){var h=t[o];_.isArray(r)||(r=[r]),_.forEach(r,function(t){var u,l;return l=_.find(r,function(t){return _.isPlainObject(t)&&t.isRequired===!0}),!l&&!s.Validations.exists(h)||i[o]?!1:void(_.isFunction(t)?(t=_.bind(t,this),u=t(h),u?i[o]=u:(n[o]=h,this.trigger("valid",this,n),this.trigger("valid:"+o,this,h))):_.isPlainObject(t)&&_.forOwn(t,function(s,r){var u;r="isRequired"===r?"exists":r,e.Validations[r]&&(u=_.isBoolean(s)?e.Validations[r](h)===s:e.Validations[r](h,s),u?(n[o]=h,this.trigger("valid",this,n),this.trigger("valid:"+o,this,h)):i[o]=t.message||o+" is not valid.")},this))},this)},this),_.size(i))?i:void 0},createCache:function(t,i){return t=t||this.cacheId,i=i||this.cacheType||"localStorage",t&&(this.cache=new e.Storage({type:i,namespace:t})),this},fetchCache:function(){return this.cache&&this.set(this.cache.getAll()),this},saveCache:function(){return this.cache&&this.cache.setAll(this.attributes),this},destroyCache:function(){return this.cache&&this.cache.clearAll(),this}}),_.extend(e.Model.prototype,e.Subscriptions),e.Collection=i.Collection.extend({constructor:function(t,e){e=e||{},this.cid=_.uniqueId("collection"),this.cacheId=e.cacheId||this.cacheId,this.cacheType=e.cacheType||this.cacheType,this._views=[],this._subscriptions={},this.createCache(),i.Collection.prototype.constructor.apply(this,arguments),this.addSubscriptions()},model:s.Model,cacheId:null,cacheType:"localStorage",toString:function(){return"[object Collection]"},getAttributes:function(){return this.map(function(t){return t.attributes})},getLocalAttributes:function(){return this.map(function(t){return t.getLocalAttributes()})},createCache:function(t,i){return t=t||this.cacheId,i=i||this.cacheType||"localStorage",t&&(this.cache=new e.Storage({type:i,namespace:t})),this},fetchCache:function(){return this.cache&&this.set(this.cache.getAll()),this},saveCache:function(){return this.cache&&this.cache.setAll(this.getAttributes()),this},destroyCache:function(){return this.cache&&this.cache.clearAll(),this}}),_.extend(e.Collection.prototype,e.Subscriptions),e.View=i.View.extend({constructor:function(t){t=t||{},this.options=_.extend({},this.options,t),this.cid=_.uniqueId("view"),this._elements={},this._bindings={},this._subscriptions={},this._isFisrtRender=!0,this._isRendered=!1,this._isUnplugged=!1,this._isRemoved=!1,this._configure.call(this,t),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents(),this.addBindings(),this.addSubscriptions()},_configure:function(){return this},toString:function(){return"[object View]"},template:null,context:function(){return{}},renderTemplate:function(t,i){var e="";return t&&i?(i=_.isPlainObject(i)?i:_.result(this,"context"),t=_.isFunction(t)?t:this.template):(i=_.isPlainObject(t)?t:_.result(this,"context"),t=_.isFunction(t)?t:this.template),t&&(e=t.call(this,i)),e},render:function(t,i){return this.trigger("before:render",this),this.$el.html(this.renderTemplate(t,i)),this._isRendered=!0,this.addElements(),this.trigger("after:render",this),this.onRender(this),this._isFisrtRender=!1,this},onRender:function(){return this},isFirstRender:function(){return this._isFisrtRender},isRendered:function(){return this._isRendered},unplug:function(){return this.trigger("before:unplug",this),this.off(),this.stopListening(),this.$el.off(),this.undelegateEvents(),this.removeElements(),this.options=null,this._isUnplugged=!0,this.trigger("after:unplug",this),this.onUnplug(this),this},onUnplug:function(){return this},isUnplugged:function(){return this._isUnplugged},remove:function(){return this.unplug(!0),this.trigger("before:remove",this),this.$el.remove(),this._isRemoved=!0,this.trigger("after:remove",this),this.onRemove(this),this},onRemove:function(){return this}}),_.extend(e.View.prototype,e.Bindings),_.extend(e.View.prototype,e.Subscriptions),_.extend(e.View.prototype,e.Mixin.hasPartials),_.extend(e.View.prototype,e.Mixin.hasElements),e.ModelView=e.View.extend({_configure:function(t){this.model=t.model||this.model,this._isFirstModel=!0,this.setModel(this.model)},model:s.Model,hasModel:function(){return s.Util.isModel(this.model)&&this.model.cid?!0:!1},getModel:function(){return s.Util.isModel(this.model)?this.model:_.isFunction(this.model)?this.model():s.Model},setModel:function(t,i){return this.hasModel()&&!this._isFirstModel&&this.unsetModel(),t=s.Util.getInstance(t||this.getModel(),i),this.trigger("before:setModel",t),s.Util.isModel(t)?(this.model=t,this.model._views.push(this.cid),this.trigger("after:setModel",t),this.onSetModel(t),this._isFirstModel=!1,this):this},onSetModel:function(){return this},unsetModel:function(){var t;return this.hasModel()?(t=this.model,this.trigger("before:unsetModel",t),this.model._views.splice(_.indexOf(this.model._views,this.cid),1),this.stopListening(t),this.model=null,this.trigger("after:unsetModel",t),this.onUnsetModel(t),this):this},onUnsetModel:function(){return this},context:function(){return this.model.attributes},unplug:function(){return e.View.prototype.unplug.apply(this,arguments),this.unsetModel(),this}}),e.FormView=e.ModelView.extend({saveOnSubmit:!0,formSelector:"",setForm:function(t){return t=t||_.result(this,"formSelector"),this.$form&&this.$form.off("submit"),this.$form=s.Util.isJqueryObject(t)?t:this.$(t),this.$form.length||(this.$form=this.$el),this.form=this.$form[0],this.$form.length&&this.$form.on("submit",_.bind(function(t){t.preventDefault(),this.submit(t)},this)),this},setModel:function(t,i){return this.hasModel()&&this.unsetModel(),t=s.Util.getInstance(t||this.getModel(),i),this.trigger("before:setModel",t),s.Util.isModel(t)?(this.model=t,this.model._views.push(this.cid),this.listenTo(this.model,"valid",this.onValid),this.listenTo(this.model,"invalid",this.onInvalid),this.trigger("after:setModel",t),this.onSetModel(t),this):this},render:function(){return e.View.prototype.render.apply(this,arguments),this.setForm(),this},submit:function(){return this.trigger("before:submit"),this.setAttributes(),this.model.validationError?this.onValidationError(this.model.validationError):(this.clean(),this.onValidationSuccess(this),this.saveOnSubmit&&this.model.save()),this.trigger("after:submit"),this.onSubmit(this),this},onValidationError:function(){return this},onValidationSuccess:function(){return this},onSubmit:function(){return this},getAttributeElement:function(t){return this.$form.find("[name="+t+"]")},getAttributeErrorElement:function(t){return this.$form.find("[data-error="+t+"]")},getAttributeValue:function(t){var i,e,s,n;if(i=this.getAttributeElement(t)){if(i.is(":radio, :checkbox"))return e=i.filter(":checked"),n=e.val(),e.length?e.length>1&&i.is(":checkbox")?_.compact(_.map(e,function(){return n})):e.attr("value")?("true"===n&&(n=!0),"false"===n&&(n=!1),n):!0:!1;if(i.is("input, textarea"))return i.length>1?_.map(i,function(t){return $(t).val()}):i.val();if(i.is("select"))return s=i.find("option").filter(":selected"),s.length?s.length>1?_.map(s,function(t){return $(t).val()}):s.attr("value")?s.val():!0:!1}return null},getAttributeValues:function(){var t,i={};return _.forEach(this.$form.find("[name]"),function(e){t=$(e).attr("name"),i[t]=this.getAttributeValue(t)},this),_.size(i)?i:null},setAttribute:function(t){return this.model.set(t,this.getAttributeValue(t),{validate:!0}),this},setAttributes:function(){var t={};return _.forEach(this.$form.find("[name]"),function(i){var e=$(i).attr("name");t[e]=this.getAttributeValue(e)},this),_.size(t)&&this.model.set(t,{validate:!0}),this},errorClass:"error",onInvalid:function(t,i){return _.forOwn(i,function(t,i){this.getAttributeElement(i).addClass(this.errorClass),this.getAttributeErrorElement(i).show().text(t)},this),this},onValid:function(t,i){return _.forOwn(i,function(t,i){this.getAttributeElement(i).removeClass(this.errorClass),this.getAttributeErrorElement(i).hide().text("")},this),this},clean:function(){return this.$form.find("[name]").removeClass(this.errorClass),this.$form.find("[data-error]").hide().text(""),this},reset:function(){return this.clean(),_.forEach(this.$form.find("[name]"),function(t){t=$(t),t.val(this.model.get(t.attr("name"))||"")},this),this},focus:function(t){var i=this.getAttributeElement(t);return i&&i.length?i.focus():this.$form.find("[name]").first().focus(),this},diff:function(){var t={};return _.forOwn(this.getAttributeValues(),function(i,e){i!==this.model.get(e)&&(t[e]=i)},this),t}}),e.CompositeView=e.View.extend({_configure:function(){this._views={},this.addViews()},unplug:function(t){return t=t||!1,t&&this.unplugViews(t),e.View.prototype.unplug.apply(this,arguments),this},remove:function(){return this.removeViews(),e.View.prototype.remove.apply(this,arguments),this}}),_.extend(e.CompositeView.prototype,e.Mixin.hasViews),e.CollectionView=e.CompositeView.extend({_configure:function(t){e.CompositeView.prototype._configure.apply(this,arguments),this.collection=t.collection||this.collection,this._isFirstCollection=!0,this._isFirstCollectionRender=!0,this.setCollection(this.collection)},collection:s.Collection,listSelector:"",addMethod:"append",itemView:e.ModelView,manageItems:!0,emptyTemplate:null,hasCollection:function(){return s.Util.isCollection(this.collection)&&this.collection.cid?!0:!1},getCollection:function(){return s.Util.isCollection(this.collection)?this.collection:_.isFunction(this.collection)?this.collection():s.Collection},setCollection:function(t,i){return this.hasCollection()&&!this._isFirstCollection&&this.unsetCollection(),this.trigger("before:setCollection",t),t=s.Util.getInstance(t||this.getCollection(),i),s.Util.isCollection(t)?(this.collection=t,this.collection._views.push(this.cid),this.trigger("after:setCollection",t),this.onSetCollection(t),this.manageItems&&(this.listenTo(this.collection,"add",this._onAdd),this.listenTo(this.collection,"reset",this._onReset),this.listenTo(this.collection,"remove",this._onRemove)),this._isFirstCollection=!1,this):this},onSetCollection:function(){return this},unsetCollection:function(){var t;return this.hasCollection()?(t=this.collection,this.trigger("before:unsetCollection",t),this.collection._views.splice(_.indexOf(this.collection._views,this.cid),1),this.stopListening(t),this.collection=null,this.trigger("after:unsetCollection",t),this.onUnsetCollection(t),this):this},onUnsetCollection:function(){return this},setList:function(t){return t=t||_.result(this,"listSelector"),this.$list=s.Util.isJqueryObject(t)?t:this.$(t),this.$list.length||(this.$list=this.$el),this.list=this.$list[0],this},render:function(){return e.View.prototype.render.apply(this,arguments),this.setList(),this.hasViews()||this.collection.isEmpty()||this.addItems(),this.renderItems(),this},renderWithFilter:function(t){return e.View.prototype.render.apply(this),this.setList(),this.filter(_.bind(t,this)),this},renderItems:function(t){var i=document.createDocumentFragment();return t=t||this.getViews(),this.trigger("before:renderItems",this),_.forEach(t,function(t){i.appendChild(t.render().el)},this),i.childNodes.length?this.$list.html(i):this.emptyTemplate&&this.$list.html(this.emptyTemplate()),this.trigger("after:renderItems",this),this.onRenderItems(t),this._isFirstCollectionRender=!1,this},isFirstCollectionRender:function(){return this._isFirstCollectionRender},onRenderItems:function(){return this},filter:function(t){var i;return _.isFunction(t)?(this.trigger("before:filter"),this.removeItems(),i=this.collection.filter(function(i){return t(i)===!0}),i.length?(this.removeItems(),this.addItems(i),this.renderItems()):this.$list.empty(),this.trigger("after:filter"),this.onFilter(i),this):this},onFilter:function(){return this},appendItem:function(t){return s.Util.isView(t)?(this.trigger("before:appendItem",this),1===this.collection.length&&this.$list.empty(),this.$list.append(t.render().el),this.trigger("after:appendItem",this),this.onAppendItem(t),this):this},onAppendItem:function(){return this},prependItem:function(t){return s.Util.isView(t)?(this.trigger("before:prependItem",this),1===this.collection.length&&this.$list.empty(),this.$list.prepend(t.render().el),this.trigger("after:prependItem",this),this.onPrependItem(t),this):this},onPrependItem:function(){return this},getItemView:function(t){return s.Util.isView(this.itemView)?this.itemView:_.isFunction(this.itemView)?this.itemView(t):s.ModelView},addItem:function(t){var i;return s.Util.isModel(t)?(this.trigger("before:addItem",this),i=s.Util.getInstance(this.getItemView(t),{model:t}),this.addView(t.cid,i),this.trigger("after:addItem",this),this.onAddItem(i),this):this},onAddItem:function(){return this},addItems:function(t){return t=t||this.collection.models,_.forEach(t,function(t){this.addItem(t)},this),this},removeItem:function(t){var i;return s.Util.isModel(t)&&this.hasView(t.cid)?(i=this.getView(t.cid),this.trigger("before:removeItem",this),i.unplug(!0),this.removeView(t.cid),this.trigger("after:removeItem",this),this.onRemoveItem(i),this):this},onRemoveItem:function(){return this},removeItems:function(t){return t=t||this.collection.models,_.forEach(t,function(t){this.removeItem(t)},this),this},unplug:function(){return this.unsetCollection(),e.View.prototype.unplug.apply(this,arguments),this},_onAdd:function(t){return this.addItem(t),this.isRendered()&&("append"===this.addMethod?this.appendItem(this.getView(t.cid)):this.prependItem(this.getView(t.cid))),this},_onReset:function(){return this.removeViews(),_.forEach(this.collection.models,function(t){this.addItem(t)},this),this.isRendered()&&this.renderItems(),this},_onRemove:function(t){return this.removeItem(t),this}}),e.Region=function(t){t=t||{},this.options=_.extend({},this.options,t),this.el=t.el||this.el,this.view=t.view||this.view,this.el||s.Util.Error('Region must have an "el" property.'),this.cid=_.uniqueId("region"),this._view=this.view,this._isShown=!1,this._isUnplugged=!1,this._isRemoved=!1,this._elements={},this._subscriptions={},this.setElement(),this.view&&this.setView(this._view),this.initialize.apply(this,arguments),this.addSubscriptions()},_.extend(e.Region.prototype,{initialize:function(){return this},keepEl:!1,toString:function(){return"[object Region]"},view:s.View,hasView:function(){return s.Util.isView(this.view)},setElement:function(t){return t=t||_.result(this,"el"),this.$el=s.Util.isJqueryObject(t)?t:s.$(t),this.$el.length&&(this.el=this.$el[0]),this.delegateEvents(),this},$:function(t){return this.$el.find(t)},setView:function(t,i){return t=t||this._view,s.Util.isView(t)?(this.hasView()&&this.isShown()&&this.close(),this.view=s.Util.getInstance(t,i),this):this},renderView:function(){return this.$el.html(this.view.render().el),this},show:function(t){return t&&this.setView(t),this.hasView()||this.setView(this._view),this.trigger("before:show",this.view),this.$el||this.setElement(),this.hasView()&&this.renderView(this.view),this._isShown=!0,this.addElements(),this.trigger("after:show",this.view),this.onShow(this.view),this},onShow:function(){return this},isShown:function(){return this._isShown},close:function(){return this.trigger("before:close",this.view),this.hasView()&&this.view.remove(),this.view=null,this._isShown=!1,this.trigger("after:close",this.view),this.onClose(this.view),this},onClose:function(){return this},unplug:function(t){t=t||!1,t&&this.hasView()&&this.view.unplug(!0),this.trigger("before:unplug",this),this.off(),this.stopListening(),this.$el.off(),this.undelegateEvents(),this.removeElements(),this._isUnplugged=!1,this.trigger("after:unplug",this),this.onUnplug(this)},onUnplug:function(){return this},isUnplugged:function(){return this._isUnplugged},remove:function(){return this.keepEl||this.close(),this.unplug(!0),this.trigger("before:remove",this),this.keepEl||this.$el.remove(),this.view=null,this._isRemoved=!1,this.trigger("after:remove",this),this.onRemove(),this},onRemove:function(){return this},isRemoved:function(){return this._isRemoved}}),_.extend(e.Region.prototype,e.Subscriptions),_.extend(e.Region.prototype,e.Mixin.hasElements),e.Region.extend=e.extend,e.Layout=function(t){t=t||{},this.options=_.extend({},this.options,t),this.el=t.el||this.el,this.regions=t.regions||this.regions,this.el||s.Util.Error('Layout must have an "el" property.'),this.cid=_.uniqueId("layout"),this._isRemoved=!1,this._isRendered=!0,this._isUnplugged=!1,this._isFisrtRendered=!0,this._regions={},this._elements={},this._subscriptions={},this.setElement(_.result(this,"el")),this.initialize.apply(this,arguments),this.addSubscriptions()
},_.extend(e.Layout.prototype,{keepEl:!1,initialize:function(){return this},toString:function(){return"[object Layout]"},setElement:function(t){return t=t||_.result(this,"el"),this.$el=s.Util.isJqueryObject(t)?t:s.$(t),this.$el.length&&(this.el=this.$el[0]),this.delegateEvents(),this.isFirstRender()||(this.addRegions(),this.addElements()),this},$:function(t){return this.$el.find(t)},template:null,context:function(){return{}},renderTemplate:function(){return s.View.prototype.renderTemplate.apply(this,arguments)},render:function(t,i){return this.trigger("before:render",this),this.$el||this.setElement(),this.$el.html(this.renderTemplate(t,i)),this._isRendered=!0,this._isFisrtRendered=!1,this.addRegions(),this.addElements(),this.trigger("after:render",this),this.onRender(this),this},onRender:function(){return this},isFirstRender:function(){return this._isFisrtRender},isRendered:function(){return this._isRendered},unplug:function(t){t=t||!1,t&&this.unplugRegions(!0),this.trigger("before:unplug",this),this.off(),this.stopListening(),this.$el.off(),this.undelegateEvents(),this._isUnplugged=!0,this.trigger("after:unplug",this),this.onUnplug(this)},onUnplug:function(){return this},isUnplugged:function(){return this._isUnplugged},empty:function(){return this.trigger("before:empty",this),this.$el.empty(),this._isEmpty=!0,this.trigger("after:empty",this),this.onEmpty(this),this},onEmpty:function(){return this},isEmpty:function(){return this._isEmpty},remove:function(){return this.unplug(!0),this.removeRegions(),this.removeElements(),this.trigger("before:remove",this),this.keepEl||this.$el.remove(),this._isRemoved=!0,this.trigger("after:remove",this),this.onRemove(),this},onRemove:function(){return this},isRemoved:function(){return this._isRemoved}}),_.extend(e.Layout.prototype,e.Subscriptions),_.extend(e.Layout.prototype,e.Mixin.hasRegions),_.extend(e.Layout.prototype,e.Mixin.hasElements),e.Layout.extend=e.extend,e.Controller=function(t){t=t||{},this.options=_.extend({},this.options,t),this.cid=_.uniqueId("controller"),this._isUnplugged=!1,this._views={},this._regions={},this._layouts={},this._subscriptions={},this.setTitle(),this.addViews(),this.addRegions(),this.addLayouts(),this.initialize.apply(this,arguments),this.addSubscriptions()},_.extend(e.Controller.prototype,{toString:function(){return"[object Controller]"},initialize:function(){return this},name:null,title:null,setTitle:function(t){return document.title=t||this.title,this},hasFocus:function(){return document.hasFocus()},scrollTo:function(t,i){return window.scrollTo(t,i),this},scrollToTop:function(){return window.scrollTo(0,0),this},scrollToBottom:function(){return window.scrollTo(0,$(document).height()),this},unplug:function(){return this.trigger("before:unplug",this),this.off(),this.stopListening(),this.removeViews(),this.removeRegions(),this.removeLayouts(),this._isUnplugged=!0,this.trigger("after:unplug",this),this.onUnplug(this),this},onUnplug:function(){return this},isUnplugged:function(){return this._isUnplugged}}),_.extend(e.Controller.prototype,e.Subscriptions),_.extend(e.Controller.prototype,e.Mixin.hasViews),_.extend(e.Controller.prototype,e.Mixin.hasRegions),_.extend(e.Controller.prototype,e.Mixin.hasLayouts),e.Controller.extend=e.extend,e.Router=i.Router.extend({constructor:function(){this.cid=_.uniqueId("router"),this._isUnplugged=!1,this._subscriptions={},i.Router.prototype.constructor.apply(this,arguments),this.addSubscriptions()},toString:function(){return"[object Router]"},getFragment:function(){return i.history.getFragment()},getRoute:function(){var t,e=null,s=null,n=i.history.getFragment();return t=_.find(i.history.handlers,function(t){return t.route.test(n)}),t&&(e=t.route,s=this._extractParameters(e,n)),{route:e,params:s,fragment:n}},execute:function(){this.trigger("before:route",this),this.beforeRoute.apply(this,arguments),i.Router.prototype.execute.apply(this,arguments),this.trigger("after:route",this),this.afterRoute.apply(this,arguments)},beforeRoute:function(){return this},afterRoute:function(){return this},unplug:function(){return this.trigger("before:unplug",this),this.off(),this.stopListening(),this._isUnplugged=!0,this.trigger("after:unplug",this),this.onUnplug(this),this},onUnplug:function(){return this},isUnplugged:function(){return this._isUnplugged}}),_.extend(e.Router.prototype,e.Subscriptions),e.Application=e.Router.extend({constructor:function(t){t=t||{},this.options=_.extend({},this.options,t),this.controller=null,s.Router.prototype.constructor.apply(this,arguments)},toString:function(){return"[object Application]"},setController:function(t,i){return s.Util.isController(t)?(this.unsetController(),this.controller=s.Util.getInstance(t,i),this):this},unsetController:function(){return this.controller&&this.controller.unplug(),this.controller=null,this},isCurrentController:function(t){return this.controller.name===t},start:function(t){return this.broadcast("app:before:start"),i.History.started||i.history.start(t),this.broadcast("app:after:start"),this.onStart(),this},onStart:function(){return this},reload:function(){this.broadcast("app:before:reload"),i.history.loadUrl(i.history.fragment)},stop:function(){return this.broadcast("app:before:stop"),i.History.started&&i.history.stop(),this.broadcast("app:after:stop"),this.onStop(),this},onStop:function(){return this}}),e}(this,Backbone);